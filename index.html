<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>
<style>
:root{--bg:#0f1724;--card:rgba(11,18,32,0.8);--muted:#9aa4b2;--accent:#6ee7b7;--glass:rgba(255,255,255,0.03)}
*{box-sizing:border-box}
body {
  font-family: Inter, Segoe UI, Roboto, Arial, sans-serif;
  margin: 0;
  padding: 24px;
  background: url('...') no-repeat center center fixed;
  background-size: cover;
  color: #e6eef6;
  transition: background-image 0.6s ease-in-out; /* ‚¨ÖÔ∏è –æ—Å—å —Ç—É—Ç */
}
tr[draggable="true"] {
  cursor: grab;
}
tr[draggable="true"]:active {
  cursor: grabbing;
}
.container{max-width:1100px;margin:0 auto;background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);}
h1{font-size:20px;margin:0 0 12px}
.row{display:flex;gap:12px;align-items:center}
input[type=text], input[type=date]{background:var(--glass);border:1px solid rgba(255,255,255,0.04);color:inherit;padding:8px;border-radius:8px;min-width:0;width:100%}
button{background:var(--accent);border:none;padding:8px 12px;border-radius:10px;color:#02211a;cursor:pointer}
button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{padding:10px 8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03);vertical-align:top}
th{color:var(--muted);font-size:13px}
.empty{color:var(--muted);padding:18px;text-align:center}
.stars{display:flex;gap:4px;cursor:pointer}
.star{font-size:18px;color:#334155}
.star.active{color:#facc15}
.status-icon{height:100px;width:auto;border-radius:8px;cursor:pointer;object-fit:contain;filter:grayscale(100%);transition:filter 0.3s ease}
.status-icon.confirmed{filter:none}
.note-input {width:100%;min-height:140px; max-height:300px;background:rgba(255,255,255,0.05);color:inherit;border-radius:8px;border:none;padding:8px;font-family:inherit;resize:vertical;}
@media (max-width:640px){.row{flex-direction:column;align-items:stretch}}
</style>
</head>
<body>
<div class="container">
<h1>–ö—ñ–Ω–æ-–≤–µ—á–æ—Ä–∏ –°—Ç–∞—Å—è–Ω–∞ —ñ –¢–∞–Ω—é—à–∫–∏ üé¨</h1>
<div class="row" style="justify-content:space-between;margin-bottom:12px">
<div style="flex:1;margin-right:12px">
<input id="titleInput" type="text" placeholder="–ù–∞–∑–≤–∞ —Ñ—ñ–ª—å–º—É" />
</div>
<div>
<button id="addBtn">–î–æ–¥–∞—Ç–∏/–ó–±–µ—Ä–µ–≥—Ç–∏</button>
<button id="clearBtn" class="ghost">–û—á–∏—Å—Ç–∏—Ç–∏</button>
<button id="resetBtn" class="ghost">–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ</button>
<button id="randomBtn">üé≤ –í–∏–ø–∞–¥–∫–æ–≤–∏–π —Ñ—ñ–ª—å–º</button>
<button id="toggleBgBtn" class="ghost">üåÑ –ó–º—ñ–Ω–∏—Ç–∏ —Ñ–æ–Ω</button>
</div>
</div>
<div class="row" style="margin-bottom:12px">
<div style="flex:1;">
<label for="filterDate">–§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –ø–æ –¥–∞—Ç—ñ –ø–µ—Ä–µ–≥–ª—è–¥—É: </label>
<input id="filterDate" type="date" />
</div>
</div>
<table id="moviesTable">
<thead>
<tr>
<th>–°—Ç–∞—Ç—É—Å 1</th>
<th>–°—Ç–∞—Ç—É—Å 2</th>
<th>–ù–∞–∑–≤–∞</th>
<th>–î–∞—Ç–∏</th>
<th>–û—Ü—ñ–Ω–∫–∏</th>
<th>–î—ñ—ó</th>
<th>–ù–æ—Ç–∞—Ç–∫–∏</th>
<th>–ö–æ—Ç–∏–∫</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
<div id="empty" class="empty" style="display:none">–ü–æ–∫–∏ —â–æ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç–∏–π ‚Äî –¥–æ–¥–∞–π –ø–µ—Ä—à–∏–π —Ñ—ñ–ª—å–º –≤–∏—â–µ.</div>
</div>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCeNS4shFoJu1oeviQ_plcd6Un84Maj5pI",
  authDomain: "movies-night-87f5f.firebaseapp.com",
  projectId: "movies-night-87f5f",
  storageBucket: "movies-night-87f5f.appspot.com",
  messagingSenderId: "925709405359",
  appId: "1:925709405359:web:599d7afc8448be9278585a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const tbody=document.getElementById('tbody');
const titleInput=document.getElementById('titleInput');
const addBtn=document.getElementById('addBtn');
const clearBtn=document.getElementById('clearBtn');
const emptyDiv=document.getElementById('empty');
const filterDateInput=document.getElementById('filterDate');

function renderStars(rating, id, person) {
  let html = `<div class="stars" data-id="${id}" data-person="${person}">`;
  html += `<span class="star ${rating === 0 ? 'active' : ''}" data-value="0" title="–ë–µ–∑ –æ—Ü—ñ–Ω–∫–∏">‚®â</span>`;
  for (let i = 1; i <= 10; i++) {
    html += `<span class="star ${i <= rating ? 'active' : ''}" data-value="${i}">‚òÖ</span>`;
  }
  html += `<span class="count"> (${rating}‚òÖ)</span>`;
  html += `</div>`;
  return html;
}

function renderMovie(doc) {
  const m = doc.data();
  const tr = document.createElement('tr');
  tr.dataset.id = doc.id;
  tr.setAttribute('draggable', 'true');
  tr.setAttribute('ondragstart', 'dragStart(event)');
  tr.setAttribute('ondrop', 'drop(event)');
  tr.setAttribute('ondragover', 'allowDrop(event)');

  tr.innerHTML = `
    <td><img src="${m.confirmed ? 'https://i.pinimg.com/736x/f3/8e/a0/f38ea03f11e5810387cfc38898be03eb.jpg' : 'https://i.pinimg.com/736x/1f/68/81/1f6881ae0d62f95235dcd13a90d4d8ed.jpg'}" class="status-icon ${m.confirmed ? 'confirmed' : ''}" data-status="1" /></td>
    <td><img src="${m.confirmed2 ? 'https://i.pinimg.com/736x/f3/8e/a0/f38ea03f11e5810387cfc38898be03eb.jpg' : 'https://i.pinimg.com/736x/1f/68/81/1f6881ae0d62f95235dcd13a90d4d8ed.jpg'}" class="status-icon ${m.confirmed2 ? 'confirmed' : ''}" data-status="2" /></td>
    <td><strong>${m.title}</strong></td>
    <td>
      <div style="display:flex;flex-direction:column;gap:4px;">
        <label>–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–æ: <input type="date" value="${m.date || ''}" class="date-input" /></label>
        <label>–ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ: <input type="date" value="${m.planned || ''}" class="planned-input" /></label>
      </div>
    </td>
    <td>
      <div style="display:flex;flex-direction:column;gap:4px;">
        <div>–°—Ç–∞—Å: ${renderStars(m.stas || 0, doc.id, 'stas')}</div>
        <div>–¢–∞–Ω—è: ${renderStars(m.tanya || 0, doc.id, 'tanya')}</div>
      </div>
    </td>
    <td style="width:1%; text-align:center;">
      <div style="display:flex;flex-direction:column;gap:4px;">
        <button class="link delete-btn" title="–í–∏–¥–∞–ª–∏—Ç–∏" style="font-size:16px;padding:4px;">üóëÔ∏è</button>
      </div>
    </td>
    <td><textarea class="note-input" maxlength="300">${m.note || ''}</textarea></td>
    <td>
  ${m.confirmed ? 
    '<img src="https://www.meme-arsenal.com/memes/59976a5388e4e572de3b7e51527f80f8.jpg" style="height:80px;width:auto;" />' :
    m.planned ? 
    '<img src="https://i.pinimg.com/736x/6f/82/21/6f82217f4d9c79a72962e3d4613865bc.jpg" style="height:80px;width:auto;" />' :
    '<img src="https://media.tenor.com/oOob9PaWKM8AAAAM/angry-kitten.gif" style="height:80px;width:auto;" />'
  }
</td>
  `;

  tbody.appendChild(tr);
}
let draggedId = null;

function dragStart(e) {
  draggedId = e.target.closest('tr').dataset.id;
}

function allowDrop(e) {
  e.preventDefault();
}

function drop(e) {
  e.preventDefault();
  const targetId = e.target.closest('tr').dataset.id;
  if (!draggedId || !targetId || draggedId === targetId) return;

  const now = Date.now();
  db.collection("movies").doc(draggedId).update({ order: now });
  db.collection("movies").doc(targetId).update({ order: now + 1 });
}
function load() {
  db.collection("movies").orderBy("order").onSnapshot(snapshot => {
    tbody.innerHTML = '';
    if (snapshot.empty) {
      emptyDiv.style.display = 'block';
    } else {
      emptyDiv.style.display = 'none';
      snapshot.forEach(doc => renderMovie(doc));
    }
  });
}

addBtn.onclick = () => {
  const title = titleInput.value.trim();
  if (!title) {
    alert('–í–≤–µ–¥–∏ –Ω–∞–∑–≤—É —Ñ—ñ–ª—å–º—É');
    return;
  }

  db.collection("movies").add({
    title,
    date: '',
    planned: '',
    stas: 0,
    tanya: 0,
    note: '',
    confirmed: false,
    confirmed2: false,
    order: Date.now() // ‚¨ÖÔ∏è –æ—Å—å —Ç—É—Ç –¥–æ–¥–∞—î—Ç—å—Å—è –ø–æ—Ä—è–¥–æ–∫
  });

  titleInput.value = '';
};
clearBtn.onclick = () => { titleInput.value=''; };

tbody.addEventListener('click', e => {
  const tr = e.target.closest('tr');
  if(!tr) return;
  const id = tr.dataset.id;

  if(e.target.classList.contains('delete-btn')){
    if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ñ—ñ–ª—å–º?')) db.collection("movies").doc(id).delete();
  }

  if(e.target.classList.contains('star')){
    const person = e.target.parentElement.dataset.person;
    const val = parseInt(e.target.dataset.value,10);
    db.collection("movies").doc(id).update({ [person]: val });
  }

  if(e.target.classList.contains('status-icon')){
    const status = e.target.dataset.status;
    const field = status==='1' ? 'confirmed' : 'confirmed2';
    db.collection("movies").doc(id).update({ [field]: !tr.querySelector(`[data-status='${status}']`).classList.contains('confirmed') });
  }
});
const resetBtn = document.getElementById('resetBtn');
resetBtn.onclick = () => {
  if (confirm("–í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ —Ñ—ñ–ª—å–º–∏?")) {
    db.collection("movies").get().then(snapshot => {
      snapshot.forEach(doc => db.collection("movies").doc(doc.id).delete());
    });
  }
};
const randomBtn = document.getElementById('randomBtn');
randomBtn.onclick = () => {
  db.collection("movies").get().then(snapshot => {
    const docs = snapshot.docs;
    if (docs.length === 0) return alert("–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç–∏–π!");
    const randomDoc = docs[Math.floor(Math.random() * docs.length)];
    alert("–°—å–æ–≥–æ–¥–Ω—ñ –¥–∏–≤–∏–º–æ—Å—å: " + randomDoc.data().title);
  });
};
const toggleBgBtn = document.getElementById('toggleBgBtn');

const backgrounds = [
  "https://wallpapers.com/images/hd/totoro-satsuki-umbrella-rain-jy5aeq5zi6aa3y8l.jpg",
  "https://tse4.mm.bing.net/th/id/OIP.Ch1-ePkhdrp9DIU5piI2ZQHaEK?rs=1&pid=ImgDetMain&o=7&rm=3",
  "https://image.tmdb.org/t/p/original/uYxqCto2sr1zjdKpoEP0QcPdFxi.jpg"
  "https://kinoukr.com/uploads/posts/2024-03/w1500_48648953.jpg"
];

let currentBg = 0;

toggleBgBtn.onclick = () => {
  currentBg = (currentBg + 1) % backgrounds.length;
  document.body.style.backgroundImage = `url('${backgrounds[currentBg]}')`;
};
let noteTimers = {};

tbody.addEventListener('input', e => {
  const tr = e.target.closest('tr');
  if (!tr) return;
  const id = tr.dataset.id;

  if (e.target.classList.contains('note-input')) {
    clearTimeout(noteTimers[id]);
    const value = e.target.value;
    noteTimers[id] = setTimeout(() => {
      db.collection("movies").doc(id).update({ note: value });
      console.log("–ù–æ—Ç–∞—Ç–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –¥–ª—è", id);
    }, 1000); // 1 —Å–µ–∫—É–Ω–¥–∞ –∑–∞—Ç—Ä–∏–º–∫–∏
  }

  if (e.target.classList.contains('date-input')) {
    db.collection("movies").doc(id).update({ date: e.target.value });
  }

  if (e.target.classList.contains('planned-input')) {
    db.collection("movies").doc(id).update({ planned: e.target.value });
  }
});

load();
</script>
</body>
</html>

